name: Refresh LLM Activity Graph Cache

on:
  schedule:
    # Run every 2 hours
    - cron: '0 */2 * * *'
  workflow_dispatch:  # Allow manual trigger

jobs:
  refresh-cache:
    runs-on: ubuntu-latest
    steps:
      - name: Purge GitHub camo image cache
        run: |
          echo "Purging LLM activity graph from GitHub's camo cache..."

          # Extract the camo URL from the profile page
          CAMO_URL=$(curl -s https://github.com/tre-dev | \
            grep -i "llm.timoreichert.com" | \
            grep -o 'https://camo.githubusercontent.com/[^"]*' | \
            head -1)

          if [ -n "$CAMO_URL" ]; then
            echo "Found camo URL: $CAMO_URL"
            RESPONSE=$(curl -w "\n" -s -X PURGE "$CAMO_URL")
            echo "Response: $RESPONSE"
            echo "Cache purged successfully"
          else
            echo "Error: Could not find camo URL for LLM activity graph"
            exit 1
          fi
